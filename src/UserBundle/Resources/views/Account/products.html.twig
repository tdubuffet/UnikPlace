{% extends 'UserBundle::base.html.twig' %}

{% block title %}Mes produits{% endblock %}

{% block description %}{% endblock %}

{% block javascript_include %}{{ jsinit(['products']) }}{% endblock javascript_include %}

{% block account_content %}
  <h2>Mes produits</h2>
  {# flashbag #}
  {% for type, messages in app.session.flashbag.all() %}
    {% for message in messages %}
      <div class="alert alert-{{ type }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endfor %}

  <div class="table-responsive">
    {% if pager.currentPageResults|length > 0 %}
      <table class="table table-hover">
        <thead>
        <tr>
          <th>Date de création</th>
          <th>Titre</th>
          <th>Statut</th>
          <th>Prix</th>
          <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for product in pager.currentPageResults %}
          <tr>
            <td>le {{ product.createdAt|date("d/m/Y H:i:s") }}</td>
            <td>
              {% if product.status.name == "published" %}
                <a href="{{ path("product_details", {'id': product.id, 'slug': product.slug}) }}">{{ product.name }}</a>
              {% else %}
                {{ product.name }}
              {% endif %}
            </td>
            <td>
              {% if product.status.name == "awaiting" %}
                <span class="label label-info">{{ product.status.label }}</span>
              {% elseif product.status.name == "published" %}
                <span class="label label-success">{{ product.status.label }}</span>
              {% elseif product.status.name == "refused" %}
                <span class="label label-danger">{{ product.status.label }}</span>
              {% endif %}
            </td>
            <td>{{ product.price|currency_convert_format(product.currency.code) }}</td>
            <td>
              <button class="btn btn-danger" data-id="{{ product.id }}" data-name="{{ product.name }}"
                      data-toggle="modal" data-target="#deleteProductModal">Supprimer
              </button>
              <button class="btn btn-info" data-id="{{ product.id }}" data-name="{{ product.name }}"
                      data-price="{{ product.price }}" data-toggle="modal" data-target="#updateProductModal">
                Modifier le prix
              </button>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      Aucun produit, vous pouvez <a href="#">déposer un produit</a>
    {% endif %}
  </div>

  {% if pager.getNbPages() > 1 %}
    {{ pagerfanta(pager, "twitter_bootstrap3_translated", pagerfanta_opts) }}
  {% endif %}

  <div class="modal fade" tabindex="-1" role="dialog" id="deleteProductModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="deleteProductModalTitle"></h4>
        </div>
        <div class="modal-body" id="deleteProductModalBody">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="deleteProductModalConfirm">Confirmer</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

  <div class="modal fade" tabindex="-1" role="dialog" id="updateProductModal">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          <h4 class="modal-title" id="updateProductModalTitle"></h4>
        </div>
        <div class="modal-body" id="updateProductModalBody">
          <div class="form-group">
            <label for="price">Nouveau prix :</label>
            <input type="text" name="price" class="form-control" id="price">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
          <button type="submit" class="btn btn-primary" id="updateProductModalConfirm">Confirmer</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->

{% endblock %}

