{% extends "UserBundle::base.html.twig" %}

{% block title %}Mon portefeuille{% endblock %}
{% block description %}Mon portefeuille sur Noname{% endblock %}


{% block account_content %}

  <h2>Mon argent</h2>


  <div class="row">

    <div class="col-md-4 col-md-offset-4">

      <div class="box text-center text-center wallet-amount">
        {{ (wallet.Balance.Amount/100)|number_format(2, ',', ' ') }} {{ wallet.Balance.Currency }}
      </div>

      <a class="btn btn-primary btn-block"  data-toggle="modal" data-target="#transferBank">
        Retrait de mon argent
      </a>

      <a class="btn btn-outline btn-block" href="{{ path('user_account_bank') }}" title="Gérer mon RIB">
        Gérer mon RIB
      </a>

    </div>

  </div>



  <h2>Historique de vos transactions</h2>

  <div class="table-responsive">
    <table style="" class="classifieds-table table table-hover">
      <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Montant de la vente</th>
        <th>Montant crédité</th>
        <th>Statut</th>
      </tr>
      </thead>
      <tbody>
      {% for transaction in transactions %}
        <tr>

          <td>{{ transaction.CreationDate|date('d/m/Y à H:i') }}</td>
          <td>{% if (transaction.Type == 'TRANSFER' or transaction.Type == 'PAYIN') %}Crédit{% else %}Débit{% endif %}</td>
          <td>
            {% if (transaction.Type == 'TRANSFER' or transaction.Type == 'PAYIN') %}
              + {{ (transaction.DebitedFunds.Amount/100)|number_format(2, ',', ' ') }} € ( dont {{ (transaction.Fees.Amount/100)|number_format(2, ',', ' ') }} € de commission)
            {% else %}
              - {{ (transaction.CreditedFunds.Amount/100)|number_format(2, ',', ' ') }} €
            {% endif %}
          </td>
          <td>{{ (transaction.CreditedFunds.Amount/100)|number_format(2, ',', ' ') }} €</td>
          <td>
            {% if transaction.Status == "FAILED" %}
              <span class="label label-danger">Annulé/Echoué</span>
            {% elseif transaction.Status == "CREATED" %}
              <span class="label label-primary">En traitement</span>
            {% elseif transaction.Status == "SUCCEEDED" %}
              <span class="label label-success">Validé</span>
            {% else %}
              {{ transaction.Status }}
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr><td colspan="5" class="text-center">Aucune transaction</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>


  <div id="transferBank" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Fermer"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title">Demande de reversement</h4>
        </div>
        <div class="modal-body">
          {% if  wallet.Balance.Amount > 0 %}
            <div class="text-center">
              <h5>Découvrez le montant de votre argent disponible<br />sur votre compte NoName.</h5>
              <p class="wallet-amount">{{ (wallet.Balance.Amount/100)|number_format(2, ',', ' ') }} €</p>
              <p>Prêt à faire le virement sur votre compte bancaire ?</p>
              <p><a href="{{ path('account_wallet_transfer') }}" class="btn btn-important btn-lg btn-transfer-confirm" data-loading-text="Chargement en cours..."><i class="fa fa-credit-card"></i> Demande de virement</a></p>
            </div>
          {% else %}
            Vous ne pouvez pas demander votre reversement, vous n'avez pas d'argent sur votre portefeuille.
          {% endif %}
        </div>
        {% if wallet.Balance.Amount <= 0 %}
          <div class="modal-footer">
            <button type="button" class="btn btn-primary-outline" data-dismiss="modal">Fermer</button>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

{% endblock %}