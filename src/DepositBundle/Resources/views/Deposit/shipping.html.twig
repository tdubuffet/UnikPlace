{% extends 'AppBundle::base.html.twig' %}

{% block title %}Choix de la livraison{% endblock %}
{% block description %}Dépôt d'annonce - Livraison{% endblock %}

{% block javascript_include %}{{ jsinit(['deposit', 'addAddress']) }}{% endblock javascript_include %}

{% block body %}
<div class="main-wrapper">
  <div class="container">
    <div class="main deposit">

      <div class="deposit-steps row">
        <div class="col-sm-3">
          <div class="deposit-step">Photos</div>
        </div>
        <div class="col-sm-3">
          <div class="deposit-step">Description</div>
        </div>
        <div class="col-sm-3">
          <div class="deposit-step">Prix</div>
        </div>
        <div class="col-sm-3">
          <div class="deposit-step active">Livraison</div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-8 col-center-block">
          {% for notice in app.session.flashBag.get('notice') %}
            <div class="alert alert-success">
              {{ notice }}<br />
            </div>
          {% endfor %}

          {% for flash_message in app.session.flashBag.get('error') %}
            <div class="alert alert-danger">
              {% for error in flash_message %}
                {{ error }}<br />
              {% endfor %}
            </div>
          {% endfor %}

          <form method="post" action="{{ path('deposit_postshipping') }}" id="shipping-form">
            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <label class="required">Poids en kg</label>
                  <input type="number" name="weight" id="product-weight" class="form-control" min="1" placeholder="Poids du produit en kg">
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label>Frais de port en France métropolitaine <i class="fa fa-info-circle"></i></label>

                  <input type="number" name="shipping_fees" class="form-control" placeholder="Montant en euros">

                  <div><a href="#"><strong>Informations :</strong> Découvrez les tarifs colissimo de la poste</a></div>
                </div>
              </div>
            </div>


            <h3>Dimensions de l'objet</h3>

            <div class="row">
              <div class="col-sm-6">
                <div class="form-group">
                  <label class="required">Largeur en cm</label>
                  <input type="number" name="width" id="product-width" class="form-control" min="1" placeholder="Largeur du produit en cm">
                </div>
              </div>
              <div class="col-sm-6">
                <div class="form-group">
                  <label class="required">Longeur en cm</label>
                  <input type="number" name="length" id="product-length" class="form-control" min="1" placeholder="Longueur du produit en cm">
                </div>
              </div>

              <div class="col-sm-6">
                <div class="form-group">
                  <label class="required">Hauteur en cm</label>
                  <input type="number" name="height" id="product-height" class="form-control" min="1" placeholder="Hauteur du produit en cm">
                </div>
              </div>
            </div>

            <div class="text-center">
              <div class="checkbox">
                <label>
                  <input type="checkbox" name="by_hand" value="1" {% if app.session.get('deposit').by_hand is not defined or (app.session.get('deposit').by_hand is defined and app.session.get('deposit').by_hand == '1') %}checked{% endif %}> J'accepte la remise en main propre
                </label>
              </div>
            </div>

            <p>Merci de sélectionner une adresse de livraison parmis vos addresses enregistrées. Nous supportons actuellement uniquement la livraison en France métropolitaine.</p>
            <p>
              <button type="button" class="btn btn-link" data-toggle="modal" data-target="#addAddressModal">
                Ajouter une autre adresse à mon compte
              </button>
            </p>

            {% if addresses|length > 0 %}
              <div class="row">
                <div class="col-sm-12">
                  <div class="form-group">
                    <select type="text" name="address_id" class="form-control">
                      {% for address in addresses %}
                        <option value="{{ address.id }}">{{ address.name }} - {{ address.street }} {{ address.getCity.zipcode }} {{ address.getCity.name }}</option>
                      {% endfor %}
                    </select>
                  </div>
                </div>
              </div>
            {% endif %}

            <div class="text-center">
              <input type="submit" class="btn btn-default" value="Etape suivante" />
            </div>

          </form>
        </div><!-- col -->
      </div><!-- .row -->

    </div><!-- .main -->
  </div><!-- .container -->
</div><!-- .main-wrapper -->

<!-- Add address Modal -->
<div class="modal fade" id="addAddressModal" tabindex="-1" role="dialog" aria-labelledby="addAddressModalTitle">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addAddressModalTitle">Ajouter une adresse à mon compte</h4>
      </div>
      {{ form_start(addAddressForm, {'action': path('deposit_postshipping'), 'attr': {'id': 'add-address-form'}}) }}
      <div class="modal-body">
        {{ form_row(addAddressForm.name) }}
        {{ form_row(addAddressForm.street) }}
        <div class="form-group">
          <label class="control-label required" for="address_city">Ville</label>
          <select id="address_city" name="address[city]" required="required" class="select-select2 autocomplete-city form-control">
            <option value="">Sélectionnez une ville</option>
          </select>
        </div>
        <div class="form-group">
          <label class="required">Téléphone <i class="fa fa-info-circle"></i></label>
          <input type="text" name="phone" class="form-control" placeholder="Numéro de téléphone">
        </div>
        {{ form_row(addAddressForm.country) }}
      </div>
      <div class="modal-footer">
        {{ form_widget(addAddressForm.save, {'attr': {'class': 'btn btn-primary'}}) }}
      </div>
      {{ form_end(addAddressForm) }}
    </div>
  </div>
</div>
{% endblock %}
