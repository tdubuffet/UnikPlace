{% extends 'AppBundle::base.html.twig' %}

{% block description %}{{ 'cart.description'|trans({ '%siteName%': siteName }, 'seo') }}{% endblock %}

{% block javascript_include %}{{ jsinit(['cart']) }}{% endblock javascript_include %}

{% block body %}
    <div class="main-wrapper">
        <div class="container">
            <div class="main">

                <div class="page-steps row">
                    <div class="col-sm-3">
                        <div class="page-step active">Mon Panier</div>
                    </div>
                    <div class="col-sm-3">
                        <div class="page-step">Mon adresse</div>
                    </div>
                    <div class="col-sm-3">
                        <div class="page-step">Mode de livraison</div>
                    </div>
                    <div class="col-sm-3">
                        <div class="page-step">Paiement</div>
                    </div>
                </div>


                {% for flashMessage in app.session.flashbag.get('notice') %}
                    <div class="alert alert-warning">{{ flashMessage }}</div>
                {% endfor %}


                {% if products is empty %}
                    <p>Votre panier est vide.</p>
                {% else %}
                    <form action="{{ path(app.request.attributes.get('_route')) }}" method="post" id="form-carts">
                        <div class="table-responsive">
                            <table class="table table-carts">
                                <thead>
                                <tr>
                                    <th>Produit</th>
                                    <th colspan="2">Nom</th>
                                    <th>Prix unitaire</th>
                                    <th>Quantit√©</th>
                                    <th>Total</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for product in products %}
                                    <tr>
                                        <td>
                                            <a target="_blank"
                                               href="{{ path('product_details', {id: product.getId(), slug: product.getSlug()}) }}">
                                                {% if product.getImages()[0] is defined %}<img
                                                    src="{{ loadpic(product.getImages()[0], 88, 88, "r3") }}"
                                                    alt="{{ product.name }} " />{% endif %}
                                            </a>
                                        </td>
                                        <td>
                                            <a target="_blank" href="{{ path('product_details', {id: product.getId(), slug: product.getSlug()}) }}">{{ product.name }}</a><br />
                                            <small>{{ product.getAddress.city.name }} ({{ product.getAddress.city.zipcode }}) - {{ product.address.country.name }}</small>
                                        </td>
                                        <td style="max-width: 5%;">
                                            <button title="Retirer de mon panier" type="button" class="btn btn-link btn-remove"
                                                    data-id="{{ product.id }}"><i
                                                        class="fa fa-trash"></i></button>
                                        </td>
                                        <td class="text-center color-price">
                                            {{ product.price|currency_convert_format('EUR', false, true, product.getCurrency.getCode) }}
                                            {% if product.getCurrency.getCode != 'EUR' %}
                                                ({{ product.price|currency_convert_format(product.getCurrency.getCode, false, true, product.getCurrency.getCode) }})
                                            {% endif %}
                                        </td>
                                        <td class="text-left">
                                            <button type="button" class="btn btn-default btn-xs" onclick="Cart.cartBtnAdd({{ product.id }}, 'remove')">-</button>
                                            <div class="btn btn-default btn-xs product-list" id="{{ product.id }}" data-price="{{ product.price }}">{{ app.session.get('cart_quantity')[product.id] }}</div>
                                            <button type="button" class="btn btn-default btn-xs" onclick="Cart.cartBtnAdd({{ product.id }}, 'add')">+</button> <span style="font-size: 0.78em;">(Max: {{ product.quantity }})</span>
                                        </td>
                                        <td class="text-right color-price total-row-price-{{ product.id }}">
                                            {{ (product.price * app.session.get('cart_quantity')[product.id])|currency_convert_format('EUR', false, true, product.getCurrency.getCode) }}
                                            {% if product.getCurrency.getCode != 'EUR' %}
                                                ({{ (product.price * app.session.get('cart_quantity')[product.id])|currency_convert_format(product.getCurrency.getCode, false, true, product.getCurrency.getCode) }})
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td colspan="6" class="text-center">Aucun produit dans le panier</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                                <tfoot class="text-right">
                                <tr>
                                    <td colspan="5" class="text-right label-table">Total</td>
                                    <td colspan="1">
                                        <span class="totalProduct color-price" data-total="{{ productsTotalPrice }}">
                                            {{ productsTotalPrice|currency_format('EUR') }}
                                        </span>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>

                        <div class="text-right">
                            <input class="btn btn-primary" type="submit" value="Continuer ma commande">
                        </div>
                    </form>

                {% endif %}

            </div><!-- .main -->
        </div><!-- .container -->
    </div><!-- .main-wrapper -->

{% endblock %}
